<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" rel="stylesheet">
    <title>绑定管理</title>
    <style>
        /* 自定义表格行样式 */
        .data-table tr:hover {
            background-color: rgba(131, 192, 253, 0.1);
        }

        .bound-row {
            background-color: rgba(248, 175, 175, 0.2);
        }

        /* 选中行样式 */
        .selected-row {
            background-color: rgba(75, 82, 248, 0.15);
            border-left: 3px solid #4B52F8;
            font-weight: 500;
        }

        /* 加载动画样式 */
        .loading {
            display: none;
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #000;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* 错误提示样式 */
        .error-message {
            color: red;
            font-size: 0.875rem;
            margin-top: 0.5rem;
        }
    </style>
</head>

<body class="bg-gray-100">
    <!-- 顶部导航栏 -->
    <nav class="bg-white shadow-md">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <a href="index.html" class="text-xl font-bold text-blue-600">2VS2</a>
            <div class="flex space-x-4">
                <a href="index.html" class="text-gray-700 hover:text-blue-600">首页</a>
                <a href="binding.html" class="text-gray-700 hover:text-blue-600">绑定</a>
                <a href="real_time_odds.html" class="text-gray-700 hover:text-blue-600">实时赔率</a>
                <a href="binding_record.html" class="text-gray-700 hover:text-blue-600">绑定记录</a>
                <a href="betting_record.html" class="text-gray-700 hover:text-blue-600">投注记录</a>
            </div>
            <div class="flex space-x-2">
                <a href="#" class="text-gray-700 hover:text-blue-600">登录</a>
                <a href="#" class="text-gray-700 hover:text-blue-600">注册</a>
            </div>
        </div>
    </nav>

    <!-- 主内容区 -->
    <div class="container mx-auto px-6 py-8 grid grid-cols-12 gap-6">
        <!-- 左侧数据源区域（占8列） -->
        <div class="col-span-12 lg:col-span-8">
            <!-- A网数据卡片 -->
            <div class="bg-white shadow-lg rounded-lg p-6">
                <div class="flex justify-between items-start mb-6">
                    <div>
                        <h3 class="text-lg font-bold text-gray-800">A网数据（1网）</h3>
                        <p class="text-sm text-gray-500">实时更新的赛事数据</p>
                        <p class="text-sm text-gray-500" id="a-count">比赛数量：0</p>
                        <p class="error-message" id="a-error"></p>
                    </div>
                    <!-- 操作按钮区 -->
                    <div class="flex items-center space-x-4">
                        <!-- 搜索框 -->
                        <div class="relative">
                            <input type="text" placeholder="搜索联赛/球队/时间"
                                class="border border-gray-300 rounded-lg px-4 py-2 w-80 focus:outline-none focus:border-blue-600">
                        </div>
                        <!-- 功能按钮 -->
                        <div class="flex items-center space-x-2">
                            <button class="bg-gray-200 px-4 py-2 rounded-lg hover:bg-gray-300" onclick="fetchData('http://localhost:6001/today_fixtures', 'a', this)">
                                刷新
                            </button>
                            <div class="loading" id="a-loading"></div>
                        </div>
                    </div>
                </div>
                <!-- 数据表格 -->
                <div class="h-80 overflow-y-auto">
                    <table class="w-full data-table" id="a-table">
                        <thead>
                            <tr class="bg-gray-100">
                                <th class="px-4 py-3 text-sm font-medium text-gray-700 text-left">比赛时间</th>
                                <th class="px-4 py-3 text-sm font-medium text-gray-700 text-left">联赛</th>
                                <th class="px-4 py-3 text-sm font-medium text-gray-700 text-left">主队</th>
                                <th class="px-4 py-3 text-sm font-medium text-gray-700 text-left">客队</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- B网数据卡片 -->
            <div class="bg-white shadow-lg rounded-lg p-6 mt-8">
                <div class="flex justify-between items-start mb-6">
                    <div>
                        <h3 class="text-lg font-bold text-gray-800">B网数据（2网）</h3>
                        <p class="text-sm text-gray-500">实时更新的赛事数据</p>
                        <p class="text-sm text-gray-500" id="b-count">比赛数量：0</p>
                        <p class="error-message" id="b-error"></p>
                    </div>
                    <!-- 操作按钮区 -->
                    <div class="flex items-center space-x-4">
                        <!-- 搜索框 -->
                        <div class="relative">
                            <input type="text" placeholder="搜索联赛/球队/时间"
                                class="border border-gray-300 rounded-lg px-4 py-2 w-80 focus:outline-none focus:border-blue-600">
                        </div>
                        <!-- 功能按钮 -->
                        <div class="flex items-center space-x-2">
                            <button class="bg-gray-200 px-4 py-2 rounded-lg hover:bg-gray-300" onclick="fetchData('http://localhost:6002/matches', 'b', this)">
                                刷新
                            </button>
                            <div class="loading" id="b-loading"></div>
                        </div>
                    </div>
                </div>
                <!-- 数据表格 -->
                <div class="h-80 overflow-y-auto">
                    <table class="w-full data-table" id="b-table">
                        <thead>
                            <tr class="bg-gray-100">
                                <th class="px-4 py-3 text-sm font-medium text-gray-700 text-left">比赛时间</th>
                                <th class="px-4 py-3 text-sm font-medium text-gray-700 text-left">联赛</th>
                                <th class="px-4 py-3 text-sm font-medium text-gray-700 text-left">主队</th>
                                <th class="px-4 py-3 text-sm font-medium text-gray-700 text-left">客队</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- C网数据卡片 -->
            <div class="bg-white shadow-lg rounded-lg p-6 mt-8">
                <div class="flex justify-between items-start mb-6">
                    <div>
                        <h3 class="text-lg font-bold text-gray-800">C网数据（3网）</h3>
                        <p class="text-sm text-gray-500">实时更新的赛事数据</p>
                        <p class="text-sm text-gray-500" id="c-count">比赛数量：0</p>
                        <p class="error-message" id="c-error"></p>
                    </div>
                    <!-- 操作按钮区 -->
                    <div class="flex items-center space-x-4">
                        <!-- 搜索框 -->
                        <div class="relative">
                            <input type="text" placeholder="搜索联赛/球队/时间"
                                class="border border-gray-300 rounded-lg px-4 py-2 w-80 focus:outline-none focus:border-blue-600">
                        </div>
                        <!-- 功能按钮 -->
                        <div class="flex items-center space-x-2">
                            <button class="bg-gray-200 px-4 py-2 rounded-lg hover:bg-gray-300" onclick="fetchData('http://localhost:6003/get_soccer_events', 'c', this)">
                                刷新
                            </button>
                            <div class="loading" id="c-loading"></div>
                        </div>
                    </div>
                </div>
                <!-- 数据表格 -->
                <div class="h-80 overflow-y-auto">
                    <table class="w-full data-table" id="c-table">
                        <thead>
                            <tr class="bg-gray-100">
                                <th class="px-4 py-3 text-sm font-medium text-gray-700 text-left">比赛时间</th>
                                <th class="px-4 py-3 text-sm font-medium text-gray-700 text-left">联赛</th>
                                <th class="px-4 py-3 text-sm font-medium text-gray-700 text-left">主队</th>
                                <th class="px-4 py-3 text-sm font-medium text-gray-700 text-left">客队</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- 右侧绑定管理区域（占4列） -->
        <div class="col-span-12 lg:col-span-4">
            <!-- 过滤与阈值设置卡片 -->
            <div class="bg-white shadow-lg rounded-lg p-6">
                <h4 class="text-base font-bold text-gray-800 mb-4">绑定过滤设置</h4>
                <div class="flex flex-col space-y-4">
                    <!-- 时间对比开关 -->
                    <div class="flex items-center space-x-2">
                        <input type="checkbox" id="timeCompare" class="w-4 h-4 accent-blue-600">
                        <label for="timeCompare" class="text-sm font-medium text-gray-700">启用时间对比</label>
                    </div>
                    <!-- 过滤关键字 -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">过滤关键字（分号分隔）</label>
                        <input type="text" value="AC;AS;FC;City;United"
                            class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:border-blue-600">
                    </div>
                    <!-- 相似度阈值 -->
                    <div class="flex items-center space-x-4">
                        <label class="text-sm font-medium text-gray-700">相似度阈值：</label>
                        <div class="flex items-center space-x-2">
                            <input type="range" min="0" max="1" step="0.05" value="0.85"
                                class="w-40 appearance-none bg-gray-200 rounded-full h-1.5 cursor-pointer"
                                style="background: linear-gradient(to right, #4B52F8 85%, #eee 85%);">
                            <span class="text-sm font-medium text-gray-800" id="precisionValue">0.85</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 已绑定比赛管理卡片 -->
            <div class="bg-white shadow-lg rounded-lg p-6 mt-8">
                <h4 class="text-base font-bold text-gray-800 mb-4">已绑定比赛列表</h4>
                <!-- 操作按钮区 -->
                <div class="flex justify-end space-x-2 mb-4">
                    <button class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700" id="addBindingBtn">添加绑定</button>
                    <button class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">模糊绑定</button>
                    <button class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">自定义绑定</button>
                    <button class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700">移除绑定</button>
                    <button class="bg-gray-200 px-4 py-2 rounded-lg hover:bg-gray-300">清空所有</button>
                </div>
                <!-- 绑定记录 -->
                <div class="h-80 overflow-y-auto">
                    <div class="space-y-6" id="boundMatchesContainer">
                        <!-- 动态生成的绑定记录会放在这里 -->
                        <!-- 示例记录（可删除） -->
                        <div class="border rounded-lg p-5">
                            <div class="flex justify-between items-start">
                                <div>
                                    <p class="text-sm font-medium text-gray-800">联赛对比</p>
                                    <span class="text-gray-600">A网：英超 | B网：英超</span>
                                </div>
                                <div>
                                    <p class="text-sm font-medium text-gray-800">时间对比</p>
                                    <span class="text-gray-600">20:00 vs 20:30</span>
                                </div>
                            </div>
                            <div class="mt-4 text-sm text-gray-600">
                                主队：曼城 vs 尤文图斯 | 客队：利物浦 vs AC米兰
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 底部预留的JavaScript逻辑 -->
    <script>
        // 示例：选中行处理函数（需根据实际逻辑完善）
        function selectRow(row, source) {
            // 清除其他行的选中状态
            document.querySelectorAll('.data-table tr').forEach(tr => {
                tr.classList.remove('selected-row');
            });
            row.classList.add('selected-row');
            // 这里可以添加将选中行数据传递到绑定管理的逻辑
            console.log(`选中${source}网数据行：`, row);
        }

        // 相似度阈值滑动条更新
        const precisionSlider = document.querySelector('input[type="range"]');
        const precisionValue = document.getElementById('precisionValue');
        precisionSlider.addEventListener('input', (e) => {
            precisionValue.textContent = e.target.value;
        });

        // 从接口获取数据并填充表格
        async function fetchData(url, source, button) {
            const loading = document.getElementById(`${source}-loading`);
            const errorElement = document.getElementById(`${source}-error`);
            loading.style.display = 'block';
            button.disabled = true;
            errorElement.textContent = '';

            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`网络响应错误: ${response.status} ${response.statusText}`);
                }
                const data = await response.json();
                console.log(`获取到的 ${source} 网数据:`, data);

                const table = document.getElementById(`${source}-table`);
                const tbody = table.getElementsByTagName('tbody')[0];
                const countElement = document.getElementById(`${source}-count`);

                if (typeof data.count === 'undefined') {
                    throw new Error('响应数据中缺少 count 字段');
                }
                if (typeof data.fixtures === 'undefined') {
                    throw new Error('响应数据中缺少 fixtures 字段');
                }

                countElement.textContent = `比赛数量：${data.count}`;
                // 清空表格
                tbody.innerHTML = '';

                data.fixtures.forEach(fixture => {
                    if (typeof fixture.time === 'undefined' || typeof fixture.league === 'undefined' || typeof fixture.home_team === 'undefined' || typeof fixture.away_team === 'undefined') {
                        console.warn('比赛数据缺少必要字段:', fixture);
                        return;
                    }
                    const row = tbody.insertRow();
                    const timeCell = row.insertCell(0);
                    const leagueCell = row.insertCell(1);
                    const homeTeamCell = row.insertCell(2);
                    const awayTeamCell = row.insertCell(3);
                    timeCell.textContent = fixture.time;
                    leagueCell.textContent = fixture.league;
                    homeTeamCell.textContent = fixture.home_team;
                    awayTeamCell.textContent = fixture.away_team;
                    row.onclick = () => selectRow(row, source);
                });
            } catch (error) {
                console.error(`获取数据时出错: ${error.message}`);
                errorElement.textContent = `获取数据时出错: ${error.message}`;
            } finally {
                loading.style.display = 'none';
                button.disabled = false;
            }
        }
    </script>
</body>

</html>    